<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORNERDS 포트폴리오 관리자</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>tailwind.config={theme:{extend:{colors:{primary:'#88C0D0',secondary:'#2E3440'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #F5F7FA;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .file-drop-zone {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-drop-zone:hover,
        .file-drop-zone.dragover {
            border-color: #88C0D0;
            background-color: #f0f9ff;
        }
        
        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            min-height: 42px;
        }
        
        .tag {
            background-color: #88C0D0;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
        }
    </style>
</head>
<body>
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-['Pacifico'] text-secondary">FORNERDS</a>
            <div class="flex items-center space-x-4">
                <span class="text-gray-600">관리자 패널</span>
                <a href="index.html" class="text-primary hover:text-secondary transition-colors">← 포트폴리오 보기</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-secondary">포트폴리오 관리</h1>
            <button id="addPortfolioBtn" class="bg-primary text-white px-6 py-3 rounded-button font-medium hover:bg-opacity-90 transition-colors">
                <i class="ri-add-line mr-2"></i>새 포트폴리오 추가
            </button>
        </div>

        <!-- 통계 카드 -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">전체 포트폴리오</p>
                        <p class="text-2xl font-bold text-secondary" id="totalCount">-</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="ri-folder-line text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">추천 포트폴리오</p>
                        <p class="text-2xl font-bold text-secondary" id="featuredCount">-</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                        <i class="ri-star-line text-yellow-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">카테고리 수</p>
                        <p class="text-2xl font-bold text-secondary" id="categoryCount">-</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                        <i class="ri-price-tag-3-line text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">태그 수</p>
                        <p class="text-2xl font-bold text-secondary" id="tagCount">-</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                        <i class="ri-hashtag text-purple-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- 포트폴리오 목록 -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-xl font-bold text-secondary">포트폴리오 목록</h2>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">제목</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">카테고리</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">태그</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">추천</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">생성일</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">작업</th>
                        </tr>
                    </thead>
                    <tbody id="portfolioTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- 동적으로 생성됨 -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- 포트폴리오 추가/수정 모달 -->
    <div id="portfolioModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 id="modalTitle" class="text-xl font-bold text-secondary">새 포트폴리오 추가</h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                    <i class="ri-close-line text-xl"></i>
                </button>
            </div>

            <form id="portfolioForm" enctype="multipart/form-data">
                <input type="hidden" id="portfolioId" name="id">
                
                <div class="mb-4">
                    <label for="title" class="block text-sm font-medium text-gray-700 mb-2">제목 *</label>
                    <input type="text" id="title" name="title" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>

                <div class="mb-4">
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-2">설명 *</label>
                    <textarea id="description" name="description" required rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                </div>

                <div class="mb-4">
                    <label for="category" class="block text-sm font-medium text-gray-700 mb-2">카테고리 *</label>
                    <select id="category" name="category" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">카테고리 선택</option>
                        <option value="AI/ML">AI/ML</option>
                        <option value="엔터프라이즈">엔터프라이즈</option>
                        <option value="IoT">IoT</option>
                        <option value="플랫폼">플랫폼</option>
                        <option value="벤치마크">벤치마크</option>
                        <option value="데이터">데이터</option>
                        <option value="OCR">OCR</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="url" class="block text-sm font-medium text-gray-700 mb-2">URL</label>
                    <input type="url" id="url" name="url" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">태그</label>
                    <div class="tag-input" id="tagInput">
                        <input type="text" id="tagInputField" placeholder="태그를 입력하고 Enter를 누르세요"
                               class="flex-1 border-none outline-none min-w-0">
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">이미지</label>
                    <div class="file-drop-zone" id="fileDropZone">
                        <i class="ri-upload-cloud-line text-3xl text-gray-400 mb-2"></i>
                        <p class="text-gray-600 mb-2">이미지를 드래그하여 놓거나 클릭하여 선택하세요</p>
                        <p class="text-sm text-gray-500">JPG, PNG, GIF, WebP (최대 5MB)</p>
                        <input type="file" id="imageFile" name="image" accept="image/*" class="hidden">
                    </div>
                    <div id="imagePreview" class="mt-4 hidden">
                        <img id="previewImage" class="w-full h-48 object-cover rounded-md">
                    </div>
                </div>

                <div class="mb-6">
                    <label class="flex items-center">
                        <input type="checkbox" id="featured" name="featured" class="mr-2">
                        <span class="text-sm font-medium text-gray-700">추천 포트폴리오로 설정</span>
                    </label>
                </div>

                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        취소
                    </button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90">
                        저장
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API 기본 설정 - Vercel 배포 환경에 맞게 동적 설정
        const API_BASE_URL = window.location.hostname === 'localhost' ? 
            'http://localhost:3000/api' : 
            `${window.location.origin}/api`;
        let currentTags = [];
        let isEditMode = false;

        // 통계 로드
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/portfolio/stats/summary`);
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    document.getElementById('totalCount').textContent = stats.total;
                    document.getElementById('featuredCount').textContent = stats.featured;
                    document.getElementById('categoryCount').textContent = Object.keys(stats.categories).length;
                    document.getElementById('tagCount').textContent = Object.keys(stats.tags).length;
                }
            } catch (error) {
                console.error('통계 로드 오류:', error);
            }
        }

        // 포트폴리오 목록 로드
        async function loadPortfolios() {
            try {
                const response = await fetch(`${API_BASE_URL}/portfolio?limit=100`);
                const result = await response.json();
                
                if (result.success) {
                    renderPortfolioTable(result.data);
                }
            } catch (error) {
                console.error('포트폴리오 로드 오류:', error);
            }
        }

        // 포트폴리오 테이블 렌더링
        function renderPortfolioTable(portfolios) {
            const tbody = document.getElementById('portfolioTableBody');
            tbody.innerHTML = portfolios.map(portfolio => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${portfolio.title}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                            ${portfolio.category}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-wrap gap-1">
                            ${portfolio.tags.map(tag => `
                                <span class="inline-flex px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">
                                    ${tag}
                                </span>
                            `).join('')}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${portfolio.featured ? 
                            '<i class="ri-star-fill text-yellow-500"></i>' : 
                            '<i class="ri-star-line text-gray-300"></i>'
                        }
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${new Date(portfolio.createdAt).toLocaleDateString('ko-KR')}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editPortfolio('${portfolio.id}')" class="text-primary hover:text-secondary mr-3">
                            <i class="ri-edit-line"></i>
                        </button>
                        <button onclick="deletePortfolio('${portfolio.id}')" class="text-red-600 hover:text-red-900">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // 포트폴리오 삭제
        async function deletePortfolio(id) {
            if (!confirm('정말로 이 포트폴리오를 삭제하시겠습니까?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/portfolio/${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('포트폴리오가 성공적으로 삭제되었습니다.');
                    await loadPortfolios();
                    await loadStats();
                } else {
                    alert(result.error || '삭제 중 오류가 발생했습니다.');
                }
            } catch (error) {
                console.error('삭제 오류:', error);
                alert('삭제 중 오류가 발생했습니다.');
            }
        }

        // 포트폴리오 수정
        async function editPortfolio(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/portfolio/${id}`);
                const result = await response.json();
                
                if (result.success) {
                    const portfolio = result.data;
                    isEditMode = true;
                    
                    document.getElementById('modalTitle').textContent = '포트폴리오 수정';
                    document.getElementById('portfolioId').value = portfolio.id;
                    document.getElementById('title').value = portfolio.title;
                    document.getElementById('description').value = portfolio.description;
                    document.getElementById('category').value = portfolio.category;
                    document.getElementById('url').value = portfolio.url || '';
                    document.getElementById('featured').checked = portfolio.featured;
                    
                    // 태그 설정
                    currentTags = [...portfolio.tags];
                    renderTags();
                    
                    // 이미지 미리보기
                    if (portfolio.image) {
                        const imageUrl = portfolio.image.startsWith('http') ? portfolio.image : 
                                       portfolio.image.includes('-') ? `${API_BASE_URL.replace('/api', '')}/uploads/${portfolio.image}` : portfolio.image;
                        document.getElementById('previewImage').src = imageUrl;
                        document.getElementById('imagePreview').classList.remove('hidden');
                    }
                    
                    document.getElementById('portfolioModal').classList.add('active');
                }
            } catch (error) {
                console.error('포트폴리오 로드 오류:', error);
                alert('포트폴리오 로드 중 오류가 발생했습니다.');
            }
        }

        // 태그 렌더링
        function renderTags() {
            const tagInput = document.getElementById('tagInput');
            const inputField = document.getElementById('tagInputField');
            
            // 기존 태그 제거
            tagInput.querySelectorAll('.tag').forEach(tag => tag.remove());
            
            // 새 태그 추가
            currentTags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${tag}
                    <button type="button" onclick="removeTag('${tag}')">&times;</button>
                `;
                tagInput.insertBefore(tagElement, inputField);
            });
        }

        // 태그 추가
        function addTag(tagText) {
            const tag = tagText.trim();
            if (tag && !currentTags.includes(tag)) {
                currentTags.push(tag);
                renderTags();
            }
        }

        // 태그 제거
        function removeTag(tag) {
            currentTags = currentTags.filter(t => t !== tag);
            renderTags();
        }

        // 모달 열기
        function openModal() {
            isEditMode = false;
            document.getElementById('modalTitle').textContent = '새 포트폴리오 추가';
            document.getElementById('portfolioForm').reset();
            document.getElementById('portfolioId').value = '';
            currentTags = [];
            renderTags();
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('portfolioModal').classList.add('active');
        }

        // 모달 닫기
        function closeModal() {
            document.getElementById('portfolioModal').classList.remove('active');
        }

        // 폼 제출
        async function submitForm(event) {
            event.preventDefault();
            
            const formData = new FormData();
            const form = document.getElementById('portfolioForm');
            
            // 기본 필드 추가
            formData.append('title', form.title.value);
            formData.append('description', form.description.value);
            formData.append('category', form.category.value);
            formData.append('url', form.url.value);
            formData.append('featured', form.featured.checked);
            formData.append('tags', currentTags.join(','));
            
            // 이미지 파일 추가
            if (form.image.files[0]) {
                formData.append('image', form.image.files[0]);
            }
            
            try {
                const url = isEditMode ? 
                    `${API_BASE_URL}/portfolio/${form.id.value}` : 
                    `${API_BASE_URL}/portfolio`;
                
                const method = isEditMode ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(isEditMode ? '포트폴리오가 성공적으로 수정되었습니다.' : '포트폴리오가 성공적으로 추가되었습니다.');
                    closeModal();
                    await loadPortfolios();
                    await loadStats();
                } else {
                    alert(result.error || '저장 중 오류가 발생했습니다.');
                }
            } catch (error) {
                console.error('저장 오류:', error);
                alert('저장 중 오류가 발생했습니다.');
            }
        }

        // 이벤트 리스너
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadPortfolios();

            // 모달 이벤트
            document.getElementById('addPortfolioBtn').addEventListener('click', openModal);
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('portfolioForm').addEventListener('submit', submitForm);

            // 태그 입력 이벤트
            document.getElementById('tagInputField').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTag(this.value);
                    this.value = '';
                }
            });

            // 파일 드롭 존 이벤트
            const dropZone = document.getElementById('fileDropZone');
            const fileInput = document.getElementById('imageFile');
            const imagePreview = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');

            dropZone.addEventListener('click', () => fileInput.click());
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileSelect(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });

            function handleFileSelect(file) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewImage.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            }

            // 모달 외부 클릭 시 닫기
            document.getElementById('portfolioModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    closeModal();
                }
            });
        });

        // 전역 함수
        window.deletePortfolio = deletePortfolio;
        window.editPortfolio = editPortfolio;
        window.removeTag = removeTag;
    </script>
</body>
</html> 